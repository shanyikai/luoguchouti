## 洛谷抽题

洛谷抽题可以快速随机抽取符合某些要求的题目。

洛谷抽题目前支持以下筛选方式：

* 指定题库，如 `P`，`CF`，`UVA` 等；
* 指定难度，如 `入门`，`提高+/省选` 等；
* 指定含有、不含有、同时含有、不同时含有某些标签。

以及以下抽取方式：

* 批量抽取
* 抽取一个题目并自动在浏览器内打开
* 保存到文件

同时，洛谷抽题提供了一个洛谷题目的数据库。

## 下载

洛谷抽题使用 `Python` 编写，并用 `pyinstaller` 打包。

在 [Github](https://github.com/shanyikai/luoguchouti) 上或 [洛谷剪贴板](https://www.luogu.com.cn/paste/fxuvfmzc) 上查看源代码。

## 使用教程

下载并解压后，你需要看的是文件 `main.exe` 与文件夹 `data/`。

其中，`data/` 文件夹下存储的是你编写的抽取规则，详细格式见下。

---

`main.exe` 是洛谷抽题的主程序。打开后，输入抽取规则名称（即 `data/` 文件夹下的一个文件的文件名，无需后缀名 `.json`）并按下回车就打开了这个抽取规则。

想要抽取题目，输入 $n$ 并按下回车，如果 $n$ 为正整数，输出 $n$ 个符合条件的题目；如果 $n\le0$ 或 $n$ 不是数字，在浏览器内打开 $1$ 个符合条件的题目（可以直接按下回车）。

特别地，输入 `quit` 退出。

---

再来看抽取规则的编写。所有抽取规则都是一个 [JSON 文件](https://www.runoob.com/json/json-syntax.html)，并被放在 `data/` 下。下面是一个例子：

```json
[
    {
        "type": ["P", "CF"],
        "difficulty": [4, 5],
        "tag": [
            [1, 139],
            [4]
        ],
        "not": [
            [6],
            [13]
        ]
    },
    {
        "type": ["B"],
        "difficulty": "all",
        "tag": "all",
        "not": []
    }
]
```

让我们来详细介绍一下。

最外层是一个列表。列表的每一项都是一个具体的抽取规则。满足其中任意一个就会被抽取到，即 `||`。

对于列表的每一项，有四个键，这里拿第一项来举例子：

`type`：一个列表，代表题目必须属于列表内的题库。可选的值有 `P`、`B`、`CF`、`SP`、`AT`、`UVA`。特别地，也可以是一个字符串 `all`，代表任何题库都可以。

`difficulty`：一个列表，代表题目的难度必须在这个列表里。可选的值有 `0-7`，为难度的 ID。特别地，也可以是一个字符串 `all`，代表任何难度都可以。

`tag`：一个二维列表，代表需要含有哪些标签，每一项代表着一个标签的要求，满足其中任意一个即可，即 `||`。特别地，也可以是一个字符串 `all`，代表不需要含有任何标签。

如果为二维列表，对于每一个要求：一个列表，代表题目必须同时含有列表内的所有标签。可选的值有 `1-394`，为标签的 ID。

`not`：一个二维列表，代表不能含有哪些标签。每一项代表着一个标签的要求，满足其中任意一个就**不会**被选取，特别地，也可以是一个空数组 `[]`，代表可以有任何标签。

如果为二维列表，对于每一个要求：一个列表，代表题目**不能**同时含有列表内的所有标签。可选的值有 `1-394`，为标签的 ID。

---

形式化的说，对于题目 `p`，如果用 `p.type` 代表 `p` 所属的题库，`p.difficulty` 代表 `p` 的难度，`p.has_tag(x)` 代表 `p` 是否含有标签 `x`，满足以下条件的会被抽取：

```
(
    (p.type == "P" || p.type == "CF") &&
    (p.difficulty == 4 || p.difficulty == 5) &&
    ((p.has_tag(1) && p.has_tag(139)) || (p.has_tag(4))) &&
    (!(p.has_tag(6)) && !(p.has_tag(13)))
) || (
    (p.type == "B")
)
```

## 技术性内容

下载并解压后同样含有文件 `download.exe` 和文件夹 `problems/`。

数据库的上次更新于 2023/8/14。如果你需要更新你的数据库，请运行 `download.exe`。建议在运行前备份一下现在的 `problems/`。

`problems/` 下存储的是题目的数据库，你可以随时使用。

数据库分为六个文件夹：`P`、`B`、`CF`、`SP`、`AT`、`UVA`，存储着不同题库里的题目信息。每个文件夹下有三个文件：

`name.json`，形如：

```json
{
    "P1000": "超级玛丽游戏",
    "P1001": "A+B Problem",
    ...
}
```

代表着当前题库内的每个题目编号所对应的题目名称。注意请使用 `utf-8` 编码打开。

`difficulty.json`，形如：

```json
{
    "1": ["P1000", "P1001", ...],
    "2": ["P1002", "P1003", ...],
    ...
}
```

其中键为 $k$ 的列表代表着当前题库内所有难度为 `k` 的题目。

`tag.json` 与 `difficulty.json` 类似，其中键为 $k$ 的列表代表着当前题库内所有含有标签 `k` 的题目。